# AIv5 Decision Flow - From Data to Signal

## ğŸ¯ Quick Reference: How AIv5 Makes Predictions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AIv5 DECISION TREE                                  â”‚
â”‚                 "Should I trade this pattern?"                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            New Price Bar
                                 â”‚
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Is ticker in pattern? â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚            â”‚
                         NO            YES
                          â”‚            â”‚
                          â–¼            â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚Check if meets â”‚  â”‚  What phase?   â”‚
                â”‚qualification  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚  criteria     â”‚       â”‚       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚       â”‚
                     â”‚    â”‚        QUALIFYING  ACTIVE
                    NO   YES           â”‚       â”‚
                     â”‚    â”‚            â–¼       â–¼
                  EXIT  START    Continue   Extract
                      QUALIFYING  tracking  Features
                                            (69 dims)
                                                â”‚
                                                â–¼
                                          Run Models
                                          (XGB/DL/Ens)
                                                â”‚
                                                â–¼
                                    Calculate Probabilities
                                        P(K0...K5)
                                                â”‚
                                                â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  Calculate EV    â”‚
                                    â”‚ Î£(P(Ki)Ã—Val(Ki)) â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚                       â”‚                       â”‚
                        â–¼                       â–¼                       â–¼
                  EV < 0 or              1 â‰¤ EV < 3              EV â‰¥ 5
                  P(K5) > 30%                 â”‚                      â”‚
                        â”‚                      â–¼                      â–¼
                   âŒ AVOID            âš ï¸ MODERATE          âœ… STRONG SIGNAL
                                          SIGNAL
```

## ğŸ“Š Detailed Decision Logic

### Step 1: Pattern State Management

```
For each ticker, every new bar:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     STATE TRANSITIONS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  NONE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                                                     â”‚    â”‚
â”‚   â”‚ Meets 3 of 4 criteria:                            â”‚    â”‚
â”‚   â”‚ â€¢ BBW < 30th percentile                           â”‚    â”‚
â”‚   â”‚ â€¢ ADX < 32                                        â”‚    â”‚
â”‚   â”‚ â€¢ Volume < 35% avg                               â”‚    â”‚
â”‚   â”‚ â€¢ Range < 65% avg                                â”‚    â”‚
â”‚   â–¼                                                     â”‚    â”‚
â”‚  QUALIFYING (Days 1-10)                                â”‚    â”‚
â”‚   â”‚                                                     â”‚    â”‚
â”‚   â”‚ Day 10 reached +                                  â”‚    â”‚
â”‚   â”‚ Still meets criteria                              â”‚    â”‚
â”‚   â–¼                                                     â”‚    â”‚
â”‚  ACTIVE                                                â”‚    â”‚
â”‚   â”‚                                                     â”‚    â”‚
â”‚   â”‚ Price breaks boundary OR                          â”‚    â”‚
â”‚   â”‚ 100 days elapsed OR                               â”‚    â”‚
â”‚   â”‚ Criteria violated                                 â”‚    â”‚
â”‚   â–¼                                                     â–¼    â”‚
â”‚  COMPLETED/FAILED â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 2: Feature Extraction (Active Patterns Only)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              69-DIMENSIONAL FEATURE VECTOR                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Core Pattern (26)          EBP Composite (19)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚â€¢ Days active â”‚          â”‚â€¢ CCI score   â”‚                â”‚
â”‚  â”‚â€¢ BBW current â”‚          â”‚â€¢ VAR score   â”‚                â”‚
â”‚  â”‚â€¢ ADX trend   â”‚    +     â”‚â€¢ NES energy  â”‚     +          â”‚
â”‚  â”‚â€¢ Volume ratioâ”‚          â”‚â€¢ LPF pressureâ”‚                â”‚
â”‚  â”‚â€¢ Price pos.  â”‚          â”‚â€¢ EBP final   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                               â”‚
â”‚                    Derived Features (24)                     â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                    â”‚â€¢ BBW slope   â”‚                         â”‚
â”‚                    â”‚â€¢ Vol spike   â”‚                         â”‚
â”‚                    â”‚â€¢ Range exp.  â”‚                         â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                               â”‚
â”‚                          Result:                             â”‚
â”‚                 [0.23, 0.45, 0.12, ..., 0.89]               â”‚
â”‚                      69 numbers total                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 3: Model Prediction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MODEL ENSEMBLE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚   Feature Vector                                             â”‚
â”‚        â”‚                                                      â”‚
â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚        â–¼            â–¼            â–¼            â–¼             â”‚
â”‚   XGBoost      LightGBM    Deep CNN     Regressor          â”‚
â”‚   (0.4 weight) (0.3 weight)(0.2 weight) (0.1 weight)        â”‚
â”‚        â”‚            â”‚            â”‚            â”‚              â”‚
â”‚        â–¼            â–¼            â–¼            â–¼             â”‚
â”‚   Probabilities Probabilities Probabilities Gain%          â”‚
â”‚        â”‚            â”‚            â”‚            â”‚              â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚                 Weighted Average                             â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚              Final Probabilities:                            â”‚
â”‚              P(K0) = 0.08                                   â”‚
â”‚              P(K1) = 0.12                                   â”‚
â”‚              P(K2) = 0.28                                   â”‚
â”‚              P(K3) = 0.32  â† Highest                        â”‚
â”‚              P(K4) = 0.15                                   â”‚
â”‚              P(K5) = 0.05                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 4: Expected Value Calculation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  EXPECTED VALUE (EV)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Class   Probability  Ã—  Strategic Value  =  Contribution   â”‚
â”‚  â”€â”€â”€â”€â”€   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚   K4        0.15      Ã—       +10         =     +1.50       â”‚
â”‚   K3        0.32      Ã—       +3          =     +0.96       â”‚
â”‚   K2        0.28      Ã—       +1          =     +0.28       â”‚
â”‚   K1        0.12      Ã—       -0.2        =     -0.02       â”‚
â”‚   K0        0.08      Ã—       -2          =     -0.16       â”‚
â”‚   K5        0.05      Ã—       -10         =     -0.50       â”‚
â”‚                                             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚                                   Total EV =    +2.06        â”‚
â”‚                                                               â”‚
â”‚                         Signal: MODERATE                     â”‚
â”‚                    (1.0 â‰¤ EV < 3.0)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 5: Trading Decision

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DECISION MATRIX                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  EV Score    P(K5)    Decision         Action               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€               â”‚
â”‚   â‰¥ 5.0      <20%     STRONG BUY       Full position       â”‚
â”‚   â‰¥ 5.0      20-30%   GOOD BUY         75% position        â”‚
â”‚   3-5        <20%     MODERATE BUY     50% position        â”‚
â”‚   3-5        20-30%   WEAK BUY         25% position        â”‚
â”‚   1-3        <20%     CONSIDER         Monitor only        â”‚
â”‚   1-3        â‰¥20%     AVOID            No action           â”‚
â”‚   <1         Any      STRONG AVOID     No action           â”‚
â”‚   Any        >30%     DANGER           Short/Avoid         â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Real Example: NVDA Pattern Detection

```
Date: 2024-10-15 15:30:00

1. STATE CHECK
   â””â”€> Pattern #42: ACTIVE (Day 12)

2. FEATURE EXTRACTION
   â”œâ”€> days_in_pattern: 12
   â”œâ”€> current_bbw_20: 0.028 (very tight)
   â”œâ”€> distance_to_power: 0.015 (1.5% from breakout)
   â”œâ”€> ebp_composite: 0.812 (exceptional)
   â””â”€> ... 65 more features

3. MODEL PREDICTIONS
   â”œâ”€> XGBoost: [0.05, 0.08, 0.22, 0.35, 0.25, 0.05]
   â”œâ”€> LightGBM: [0.06, 0.10, 0.24, 0.30, 0.28, 0.02]
   â””â”€> Ensemble: [0.055, 0.09, 0.23, 0.325, 0.265, 0.035]

4. EV CALCULATION
   â””â”€> EV = 0.265Ã—10 + 0.325Ã—3 + 0.23Ã—1 + 0.09Ã—(-0.2)
           + 0.055Ã—(-2) + 0.035Ã—(-10)
        = 2.65 + 0.975 + 0.23 - 0.018 - 0.11 - 0.35
        = 3.38

5. DECISION
   â”œâ”€> EV: 3.38 (GOOD SIGNAL)
   â”œâ”€> P(K5): 3.5% (Low risk)
   â””â”€> ACTION: BUY with 50% position size

6. ACTUAL OUTCOME (30 days later)
   â””â”€> +52% gain (K3 class) âœ…
```

## ğŸ“ˆ Success Metrics

```
Pattern Flow Statistics (Based on 4-year backtest):

    1000 Tickers Monitored Daily
              â”‚
              â–¼
    ~300 Enter QUALIFYING (30%)
              â”‚
              â–¼
    ~150 Reach ACTIVE (15%)
              â”‚
              â–¼
    ~30 Generate GOOD+ Signals (3%)
              â”‚
              â–¼
    ~7-10 Achieve K3/K4 Gains (0.7-1%)

Success Rate: 23-33% of GOOD+ signals â†’ 35%+ gains
Risk/Reward: Average winner +55%, Average loser -8%
```

This decision flow shows exactly how AIv5 processes each ticker through its state machine, extracts features, makes predictions, and generates actionable trading signals based on Expected Value calculations.