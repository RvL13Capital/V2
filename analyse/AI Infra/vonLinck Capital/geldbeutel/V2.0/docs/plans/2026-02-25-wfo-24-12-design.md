# Design: 24/12 WFO Windows + Infeasible Genome Fix — geldbeutel V2.0

**Date**: 2026-02-25
**Status**: Pending approval

---

## Problem

Two WFO runs (12/6 windows) both fail:
- 6/21 windows fully infeasible (GA can't find ≥10 trades in 12-month IS)
- OOS statistics meaningless: 1–6 trades per 6-month window
- IS-OOS inverse correlation persists

**Diagnostic finding (Approach A, 2015–2025 data)**:
At d_min=0.25 with max-permissive genome, system generates ~16 trades/year. In a
12-month IS window, the GA routinely evolves toward w=10k–20k + vol_mult=2.0–3.0
regions, dropping signal to 3–6 trades/year. The IS gate of 10 traps the GA in an
all-infeasible state with no fitness gradient.

Root cause: 12 months of IS is too short for a swing system generating 16 trades/year.
One bad regime year (e.g., 2023: steady NQ uptrend, few pristine level violations)
can render the entire IS window infeasible.

---

## Decision: 24/12 WFO Windows

Double IS and OOS durations. This is the principled fix:
- No change to gene bounds → kernel retains full search space
- More IS data → GA curve-fitting risk reduced
- Larger OOS window → statistically meaningful results (see Expected Impact below)

---

## Changes

### 1. WFO Protocol: train_months=12 → 24, trade_months=6 → 12
In `run_wfo()`, change the two defaults:
```python
# Before
def run_wfo(df, train_months=12, trade_months=6, ...):
# After
def run_wfo(df, train_months=24, trade_months=12, ...):
```

No other changes to the WFO loop logic.

**New window count**: with 6-month stepping from 2015-01-01 to 2026-02-22:
- Approximately 16–17 windows (vs 21 currently)
- First OOS period: 2017-01 → 2018-01
- Last full OOS: 2024-07 → 2025-07

### 2. Fix: Infeasible Genome OOS Skip
When GA returns apex_fitness == -999999 (infeasible), the kernel currently still
deploys the genome to OOS. W5 accidentally made +$14,778 this way, distorting
results. Fix: add a check before the OOS kernel call.

```python
# In run_wfo(), before swing_liquidity_sweep_engine OOS call:
if apex_fitness < 0:
    print("  SKIP OOS: apex genome infeasible. Capital passed forward unchanged.")
    # log window with 0 trades, 0 DD, 0 Calmar, same capital
    # continue to next window
```

### 3. CLAUDE.md Updates
- WFO protocol table: 12 months → 24 months IS, 6 months → 12 months OOS
- Performance characteristics: update runtime estimate (25–40h vs 12–24h)
- Known Constraints table: update "Low swing trade frequency" row

---

## Expected Impact

| Metric | 12/6 (current) | 24/12 (proposed) |
|--------|----------------|-----------------|
| IS trades (at ~16/yr) | ~16 avg | ~32 avg |
| IS infeasible windows | 6/21 (29%) | est. 2–3/17 (12–18%) |
| OOS trades per window | 2–8 | 8–20 |
| OOS statistical power | Very low | Moderate |
| Total WFO windows | 21 | ~17 |
| WFO runtime | 12–24h | 25–40h |

**Note**: Infeasibility won't fully disappear. At the extreme corner (w=20000,
vol_mult=3.0), signal drops to ~1/yr × 2yr = 2 trades — still infeasible. But those
corners are rare: the GA needs to convergence to both extremes simultaneously. Most
IS periods will be feasible once the 2022 crash + 2021 volatility are included in
the IS window.

---

## What Does NOT Change

- Gene bounds (unchanged: w=[2000,20000], vol_mult=[0.5,3.0])
- Fitness function (pure Calmar, net/dd)
- Hard gates: min_trades=10, min_avg_hold=200 bars
- Kernel (sealed, unchanged)
- d_min lower bound (0.25%)

---

## Files Changed

1. `wfo_matrix_v2.py`:
   - `run_wfo()` signature defaults: `train_months=24, trade_months=12`
   - Infeasible genome skip: ~4 lines before OOS kernel call
2. `CLAUDE.md`:
   - WFO Protocol table: IS 12 months → 24 months, OOS 6 months → 12 months
   - Performance characteristics: runtime estimate updated
